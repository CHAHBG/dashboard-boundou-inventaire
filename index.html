<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROCASEF - Dashboard EDL Boundou</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzAwNzJCQyIvPgo8cGF0aCBkPSJNMTIgMTJIMjhWMjhIMTJWMTJaIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz4KPHBhdGggZD0iTTE2IDE2SDI0VjI0SDE2VjE2WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="loading" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Chargement des données...</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzAwNzJCQyIvPgo8cGF0aCBkPSJNMTIgMTJIMjhWMjhIMTJWMTJaIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz4KPHBhdGggZD0iTTE2IDE2SDI0VjI0SDE2VjE2WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+" alt="PROCASEF" class="logo">
                <div class="brand-text">
                    <h1>PROCASEF</h1>
                    <span>Dashboard EDL</span>
                </div>
            </div>
            <div class="nav-actions">
                <button class="nav-btn" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="nav-btn" id="exportBtn">
                    <i class="fas fa-download"></i>
                    <span>Exporter</span>
                </button>
                <button class="nav-btn" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-filter"></i> Filtres & Analyses</h3>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>

            <div class="filter-section">
                <div class="filter-group">
                    <label class="filter-label">Communes sélectionnées</label>
                    <div class="communes-filter" id="communesFilter">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Seuil minimum (données brutes)</label>
                    <div class="range-input">
                        <input type="range" id="seuilRange" min="0" max="60000" value="0" step="500">
                        <div class="range-value">
                            <span id="seuilValue">0</span>
                        </div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Niveau de performance</label>
                    <select class="filter-select" id="performanceFilter">
                        <option value="all">Tous niveaux</option>
                        <option value="excellent">Excellent (≥80%)</option>
                        <option value="good">Bon (60-80%)</option>
                        <option value="average">Moyen (30-60%)</option>
                        <option value="poor">Faible (<30%)</option>
                        <option value="zero">Aucune validation</option>
                    </select>
                </div>

                <div class="filter-actions">
                    <button class="btn btn-primary" id="applyFilters">
                        <i class="fas fa-search"></i> Appliquer
                    </button>
                    <button class="btn btn-outline" id="resetFilters">
                        <i class="fas fa-undo"></i> Réinitialiser
                    </button>
                </div>
            </div>

            <div class="analysis-section">
                <h4><i class="fas fa-chart-line"></i> Analyses rapides</h4>
                <div class="quick-stats">
                    <div class="quick-stat">
                        <span class="stat-label">Efficacité moyenne</span>
                        <span class="stat-value" id="avgEfficiency">0%</span>
                    </div>
                    <div class="quick-stat">
                        <span class="stat-label">Meilleure commune</span>
                        <span class="stat-value" id="topCommune">-</span>
                    </div>
                    <div class="quick-stat">
                        <span class="stat-label">Total parcelles</span>
                        <span class="stat-value" id="totalParcels">0</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header Section -->
            <section class="dashboard-header">
                <div class="header-content">
                    <div class="title-section">
                        <h1>Inventaire Foncier - Région du Boundou</h1>
                        <p class="subtitle">Suivi en temps réel du post-traitement EDL</p>
                        <div class="update-info">
                            <i class="fas fa-clock"></i>
                            <span>Dernière mise à jour: <span id="lastUpdate">-</span></span>
                        </div>
                    </div>
                    <div class="header-stats">
                        <div class="stat-card">
                            <div class="stat-icon bg-blue">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number" id="totalData">0</span>
                                <span class="stat-label">Données collectées</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-green">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number" id="validatedData">0</span>
                                <span class="stat-label">Validées URM/NICAD</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-orange">
                                <i class="fas fa-map-marked-alt"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number" id="totalCommunes">0</span>
                                <span class="stat-label">Communes traitées</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- KPI Section -->
            <section class="kpi-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-tachometer-alt"></i> 
                        Indicateurs de Performance
                    </h2>
                    <button class="btn btn-info btn-sm" id="showKPILegend">
                        <i class="fas fa-info-circle"></i>
                        <span>Guide des KPI</span>
                    </button>
                </div>
                <div class="kpi-grid">
                    <div class="kpi-card" data-kpi="pipeline">
                        <div class="kpi-header">
                            <h3>Efficacité Pipeline</h3>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-main">
                                <span class="kpi-value" id="pipelineEfficiency">0%</span>
                                <div class="kpi-trend positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+2.3%</span>
                                </div>
                            </div>
                            <div class="kpi-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="pipelineProgress"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="kpi-card" data-kpi="quality">
                        <div class="kpi-header">
                            <h3>Qualité Données</h3>
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-main">
                                <span class="kpi-value" id="qualityScore">0%</span>
                                <div class="kpi-trend positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+1.8%</span>
                                </div>
                            </div>
                            <div class="kpi-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="qualityProgress"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="kpi-card" data-kpi="validation">
                        <div class="kpi-header">
                            <h3>Taux Validation</h3>
                            <i class="fas fa-certificate"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-main">
                                <span class="kpi-value" id="validationRate">0%</span>
                                <div class="kpi-trend negative">
                                    <i class="fas fa-arrow-down"></i>
                                    <span>-0.5%</span>
                                </div>
                            </div>
                            <div class="kpi-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="validationProgress"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="kpi-card" data-kpi="coverage">
                        <div class="kpi-header">
                            <h3>Couverture</h3>
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="kpi-content">
                            <div class="kpi-main">
                                <span class="kpi-value" id="coverageRate">0%</span>
                                <div class="kpi-trend positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+5.2%</span>
                                </div>
                            </div>
                            <div class="kpi-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="coverageProgress"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Charts Section -->
            <section class="charts-section">
                <div class="charts-grid">
                    <!-- Pipeline Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-funnel-dollar"></i> Pipeline de Traitement</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" data-action="fullscreen" data-chart="pipeline">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="chart-btn" data-action="download" data-chart="pipeline">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="pipelineChart"></canvas>
                        </div>
                    </div>

                    <!-- Performance by Commune -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-bar"></i> Performance par Commune</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" data-action="fullscreen" data-chart="performance">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="chart-btn" data-action="download" data-chart="performance">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>

                    <!-- Validation Rates -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-pie-chart"></i> Répartition Validation</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" data-action="fullscreen" data-chart="validation">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="chart-btn" data-action="download" data-chart="validation">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="chart-btn" data-action="details" data-chart="validation">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="validationChart"></canvas>
                        </div>
                    </div>

                    <!-- Efficiency Trends -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-line"></i> Tendances d'Efficacité</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" data-action="fullscreen" data-chart="efficiency">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="chart-btn" data-action="download" data-chart="efficiency">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="efficiencyChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Data Table Section -->
            <section class="table-section">
                <div class="table-header">
                    <h2 class="section-title">
                        <i class="fas fa-table"></i> 
                        Données Détaillées
                    </h2>
                    <div class="table-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Rechercher une commune..." id="searchInput">
                        </div>
                        <div class="table-actions">
                            <button class="btn btn-outline" id="columnToggle">
                                <i class="fas fa-columns"></i>
                            </button>
                            <button class="btn btn-outline" id="tableExport">
                                <i class="fas fa-file-excel"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="dataTable">
                        <thead>
                            <tr>
                                <th data-sort="commune">
                                    <span>Commune</span>
                                    <i class="fas fa-sort"></i>
                                </th>
                                <th data-sort="donnees_brutes">
                                    <span>Données Brutes</span>
                                    <i class="fas fa-sort"></i>
                                </th>
                                <th data-sort="sans_doublons_attributaire_et_geometriqu">
                                    <span>Sans Doublons</span>
                                    <i class="fas fa-sort"></i>
                                </th>
                                <th data-sort="post_traitees">
                                    <span>Post-traitées</span>
                                    <i class="fas fa-sort"></i>
                                </th>
                                <th data-sort="valideespar_urm_nicad">
                                    <span>Validées</span>
                                    <i class="fas fa-sort"></i>
                                </th>
                                <th data-sort="validationRate">
                                    <span>Taux Validation</span>
                                    <i class="fas fa-sort"></i>
                                </th>
                                <th data-sort="globalEfficiency">
                                    <span>Efficacité</span>
                                    <i class="fas fa-sort"></i>
                                </th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Dynamically populated -->
                        </tbody>
                    </table>
                </div>
                
                <div class="table-pagination">
                    <div class="pagination-info">
                        <span id="paginationInfo">Affichage de 0 à 0 sur 0 entrées</span>
                    </div>
                    <div class="pagination-controls">
                        <button class="btn btn-sm" id="prevPage">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="page-numbers" id="pageNumbers"></div>
                        <button class="btn btn-sm" id="nextPage">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- KPI Legend Modal -->
    <div class="modal-overlay" id="kpiLegendModal">
        <div class="modal-container modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-book-open"></i> Guide des Indicateurs de Performance</h3>
                <button class="modal-close" id="closeLegendModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="legend-content">
                    <div class="legend-section">
                        <h4><i class="fas fa-chart-line"></i> Indicateurs Principaux</h4>
                        <div class="legend-grid">
                            <div class="legend-item">
                                <div class="legend-icon bg-blue">
                                    <i class="fas fa-arrow-right"></i>
                                </div>
                                <div class="legend-info">
                                    <h5>Efficacité Pipeline</h5>
                                    <p><strong>Formule :</strong> (Données Validées ÷ Données Brutes) × 100</p>
                                    <p><strong>Description :</strong> Mesure le rendement global du processus de traitement des données foncières</p>
                                    <p><strong>Exemple :</strong> 1000 parcelles collectées → 203 validées = 20.3%</p>
                                </div>
                            </div>

                            <div class="legend-item">
                                <div class="legend-icon bg-green">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="legend-info">
                                    <h5>Qualité Données</h5>
                                    <p><strong>Formule :</strong> Score composite pondéré</p>
                                    <p><strong>Composition :</strong> Dédoublonnage (20%) + Post-traitement (30%) + Validation (50%)</p>
                                    <p><strong>Description :</strong> Évalue la fiabilité et l'intégrité des données à chaque étape</p>
                                </div>
                            </div>

                            <div class="legend-item">
                                <div class="legend-icon bg-orange">
                                    <i class="fas fa-certificate"></i>
                                </div>
                                <div class="legend-info">
                                    <h5>Taux Validation</h5>
                                    <p><strong>Formule :</strong> (Validées URM/NICAD ÷ Post-traitées) × 100</p>
                                    <p><strong>Description :</strong> Proportion des données acceptées lors de la validation finale</p>
                                    <p><strong>Organismes :</strong> URM (Unité de Restructuration et de Modernisation) et NICAD</p>
                                </div>
                            </div>

                            <div class="legend-item">
                                <div class="legend-icon bg-purple">
                                    <i class="fas fa-globe"></i>
                                </div>
                                <div class="legend-info">
                                    <h5>Couverture</h5>
                                    <p><strong>Formule :</strong> (Communes avec données ÷ Total communes) × 100</p>
                                    <p><strong>Description :</strong> Mesure l'exhaustivité géographique du projet EDL</p>
                                    <p><strong>Objectif :</strong> Atteindre 100% de couverture dans la région du Boundou</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="legend-section">
                        <h4><i class="fas fa-route"></i> Pipeline de Traitement</h4>
                        <div class="pipeline-legend">
                            <div class="pipeline-step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h5>Données Brutes</h5>
                                    <p>Collecte initiale des informations foncières sur le terrain</p>
                                </div>
                            </div>
                            <div class="pipeline-arrow">→</div>
                            
                            <div class="pipeline-step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h5>Sans Doublons</h5>
                                    <p>Suppression des doublons attributaires et géométriques</p>
                                </div>
                            </div>
                            <div class="pipeline-arrow">→</div>
                            
                            <div class="pipeline-step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h5>Post-traitées</h5>
                                    <p>Nettoyage, standardisation et harmonisation des données</p>
                                </div>
                            </div>
                            <div class="pipeline-arrow">→</div>
                            
                            <div class="pipeline-step">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h5>Validées URM/NICAD</h5>
                                    <p>Validation finale par les organismes compétents</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="legend-section">
                        <h4><i class="fas fa-trending-up"></i> Interprétation des Tendances</h4>
                        <div class="trends-legend">
                            <div class="trend-item positive">
                                <i class="fas fa-arrow-up"></i>
                                <span class="trend-value">+2.3%</span>
                                <div class="trend-description">
                                    <strong>Tendance Positive :</strong> Amélioration par rapport à la période précédente
                                </div>
                            </div>
                            <div class="trend-item negative">
                                <i class="fas fa-arrow-down"></i>
                                <span class="trend-value">-0.5%</span>
                                <div class="trend-description">
                                    <strong>Tendance Négative :</strong> Détérioration nécessitant une attention particulière
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="legend-section">
                        <h4><i class="fas fa-star"></i> Niveaux de Performance</h4>
                        <div class="performance-legend">
                            <div class="performance-level excellent">
                                <span class="level-badge">Excellent</span>
                                <span class="level-range">≥ 80%</span>
                                <span class="level-description">Performance optimale</span>
                            </div>
                            <div class="performance-level good">
                                <span class="level-badge">Bon</span>
                                <span class="level-range">60-80%</span>
                                <span class="level-description">Bon niveau de qualité</span>
                            </div>
                            <div class="performance-level average">
                                <span class="level-badge">Moyen</span>
                                <span class="level-range">30-60%</span>
                                <span class="level-description">Amélioration possible</span>
                            </div>
                            <div class="performance-level poor">
                                <span class="level-badge">Faible</span>
                                <span class="level-range">< 30%</span>
                                <span class="level-description">Intervention requise</span>
                            </div>
                            <div class="performance-level zero">
                                <span class="level-badge">Zéro</span>
                                <span class="level-range">0%</span>
                                <span class="level-description">Aucune validation</span>
                            </div>
                        </div>
                    </div>

                    <div class="legend-section">
                        <h4><i class="fas fa-lightbulb"></i> Conseils d'Utilisation</h4>
                        <div class="tips-grid">
                            <div class="tip-item">
                                <i class="fas fa-filter text-blue"></i>
                                <p>Utilisez les filtres pour analyser des communes spécifiques ou des niveaux de performance</p>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-search text-green"></i>
                                <p>La fonction recherche permet de trouver rapidement une commune dans le tableau</p>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-download text-orange"></i>
                                <p>Exportez les données et graphiques pour vos rapports et présentations</p>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-expand text-purple"></i>
                                <p>Cliquez sur les graphiques pour les voir en plein écran</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle">Graphique</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <canvas id="modalChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div class="notifications-container" id="notifications"></div>

    <script src="app.js"></script>
</body>
</html>
