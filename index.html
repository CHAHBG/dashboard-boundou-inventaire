<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROCASEF Dashboard EDL</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Chargement des données...</p>
        </div>
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="logo.png" alt="Logo" class="logo">
                <div class="brand-text">
                    <h1>PROCASEF</h1>
                    <span>Dashboard EDL</span>
                </div>
            </div>
            <div class="nav-actions">
                <button class="nav-btn" id="exportBtn">
                    <i class="fas fa-download"></i> Exporter
                </button>
                <button class="nav-btn" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>Filtres & Analyses</h3>
                <button class="sidebar-toggle"><i class="fas fa-chevron-left"></i></button>
            </div>

            <div class="filter-section">
                <div class="filter-group">
                    <label class="filter-label">Communes sélectionnées</label>
                    <div id="communesFilter" class="communes-filter"></div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Seuil minimum (données brutes)</label>
                    <div class="range-input">
                        <input type="range" id="seuilSlider" min="0" max="10000" value="0">
                        <div class="range-value" id="seuilValue">0</div>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Niveau de performance</label>
                    <select id="performanceFilter" class="filter-select">
                        <option value="all">Tous niveaux</option>
                        <option value="excellent">Excellent (≥80%)</option>
                        <option value="good">Bon (60-80%)</option>
                        <option value="average">Moyen (30-60%)</option>
                        <option value="poor">Faible (<30%)</option>
                        <option value="zero">Aucune validation</option>
                    </select>
                </div>

                <div class="filter-actions">
                    <button id="applyFilters" class="btn btn-primary">Appliquer</button>
                    <button id="resetFilters" class="btn btn-secondary">Réinitialiser</button>
                </div>
            </div>

            <div class="analysis-section">
                <h4>Analyses rapides</h4>
                <div class="quick-stats">
                    <div class="quick-stat">
                        <span class="stat-label">Efficacité moyenne</span>
                        <span class="stat-value" id="avgEfficiency">0%</span>
                    </div>
                    <div class="quick-stat">
                        <span class="stat-label">Meilleure commune</span>
                        <span class="stat-value" id="bestCommune">-</span>
                    </div>
                    <div class="quick-stat">
                        <span class="stat-label">Total parcelles</span>
                        <span class="stat-value" id="totalParcels">0</span>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="dashboard-header">
                <div class="header-content">
                    <h2>Inventaire Foncier - Région du Boundou</h2>
                    <p>Suivi en temps réel du post-traitement EDL</p>
                    <p>Dernière mise à jour: <span id="lastUpdate">-</span></p>
                </div>
                <div class="header-stats">
                    <div class="stat-card">
                        <i class="fas fa-database"></i>
                        <div>
                            <h3 id="collectedData">0</h3>
                            <p>Données collectées</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <h3 id="validatedData">0</h3>
                            <p>Validées URM/NICAD</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <h3 id="processedCommunes">0</h3>
                            <p>Communes traitées</p>
                        </div>
                    </div>
                </div>
            </header>

            <section class="kpi-section">
                <h2>Indicateurs de Performance</h2>
                <button class="btn btn-info" id="kpiGuideBtn">Guide des KPI</button>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <h4>Efficacité Pipeline</h4>
                        <div class="kpi-value" id="efficiencyKPI">0%</div>
                        <div class="kpi-trend" id="efficiencyTrend"></div>
                    </div>
                    <div class="kpi-card">
                        <h4>Qualité Données</h4>
                        <div class="kpi-value" id="qualityKPI">0%</div>
                        <div class="kpi-trend" id="qualityTrend"></div>
                    </div>
                    <div class="kpi-card">
                        <h4>Taux Validation</h4>
                        <div class="kpi-value" id="validationKPI">0%</div>
                        <div class="kpi-trend" id="validationTrend"></div>
                    </div>
                    <div class="kpi-card">
                        <h4>Couverture</h4>
                        <div class="kpi-value" id="coverageKPI">0%</div>
                        <div class="kpi-trend" id="coverageTrend"></div>
                    </div>
                    <div class="kpi-card">
                        <h4>Taux Quarantaine</h4>
                        <div class="kpi-value" id="quarantaineKPI">0%</div>
                        <div class="kpi-trend" id="quarantaineTrend"></div>
                    </div>
                    <div class="kpi-card">
                        <h4>Taux Conflits</h4>
                        <div class="kpi-value" id="conflitsKPI">0%</div>
                        <div class="kpi-trend" id="conflitsTrend"></div>
                    </div>
                </div>
            </section>

            <section class="charts-section">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card">
                        <h3>Pipeline de Traitement</h3>
                        <canvas id="pipelineChart"></canvas>
                    </div>
                    <div class="card">
                        <h3>Performance par Commune</h3>
                        <canvas id="performanceChart"></canvas>
                    </div>
                    <div class="card">
                        <h3>Répartition Validation</h3>
                        <canvas id="validationChart"></canvas>
                    </div>
                    <div class="card">
                        <h3>Tendances d'Efficacité</h3>
                        <canvas id="trendsChart"></canvas>
                    </div>
                    <div class="card">
                        <h3>Répartition des Parcelles</h3>
                        <canvas id="repartitionChart"></canvas>
                    </div>
                    <div class="card">
                        <h3>Conflits par Commune</h3>
                        <canvas id="conflitsChart"></canvas>
                    </div>
                </div>
            </section>

            <section class="data-table-section">
                <h2>Données Détaillées</h2>
                <div class="table-controls">
                    <input type="text" id="tableSearch" placeholder="Rechercher une commune..." class="search-input">
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Commune</th>
                            <th>Données Brutes</th>
                            <th>Sans Doublons</th>
                            <th>Post-traitées</th>
                            <th>Validées</th>
                            <th>Individuelles</th>
                            <th>Collectives</th>
                            <th>Conflits</th>
                            <th>Sans Jointure</th>
                            <th>Taux Validation</th>
                            <th>Efficacité</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
                <div class="pagination">
                    <button id="prevPage"><i class="fas fa-chevron-left"></i></button>
                    <span id="pageInfo">Page 1 sur 1</span>
                    <button id="nextPage"><i class="fas fa-chevron-right"></i></button>
                </div>
            </section>
        </main>
    </div>

    <div class="modal" id="kpiModal">
        <div class="modal-content modal-large">
            <span class="close-btn">&times;</span>
            <h2>Guide des Indicateurs de Performance</h2>
            <div class="legend-content">
                <section class="legend-section">
                    <h4><i class="fas fa-chart-bar"></i> Indicateurs Principaux</h4>
                    <div class="legend-grid">
                        <div class="legend-item">
                            <div class="legend-icon bg-blue"><i class="fas fa-route"></i></div>
                            <div class="legend-info">
                                <h5>Efficacité Pipeline</h5>
                                <p><strong>Formule :</strong> (Données Validées ÷ Données Brutes) × 100</p>
                                <p><strong>Description :</strong> Mesure le rendement global du processus de traitement des données foncières</p>
                                <p><strong>Exemple :</strong> 1000 parcelles collectées → 203 validées = 20.3%</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon bg-green"><i class="fas fa-check-circle"></i></div>
                            <div class="legend-info">
                                <h5>Qualité Données</h5>
                                <p><strong>Formule :</strong> Poids (Dédoublonnage × 0.2 + Post-traitement × 0.3 + Validation × 0.5)</p>
                                <p><strong>Description :</strong> Évalue la qualité globale des données à travers les étapes du pipeline</p>
                                <p><strong>Exemple :</strong> 80% dédoublonnage, 90% post-traitement, 100% validation → 92%</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon bg-orange"><i class="fas fa-percentage"></i></div>
                            <div class="legend-info">
                                <h5>Taux Validation</h5>
                                <p><strong>Formule :</strong> (Données Validées ÷ Post-Traitées) × 100</p>
                                <p><strong>Description :</strong> Mesure la proportion des données post-traitées validées par URM/NICAD</p>
                                <p><strong>Exemple :</strong> 900 validées sur 1000 post-traitées → 90%</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon bg-purple"><i class="fas fa-map"></i></div>
                            <div class="legend-info">
                                <h5>Couverture</h5>
                                <p><strong>Formule :</strong> (Communes Traitées ÷ Total Communes) × 100</p>
                                <p><strong>Description :</strong> Indique le pourcentage de communes couvertes par le processus</p>
                                <p><strong>Exemple :</strong> 14 communes traitées sur 15 → 93.3%</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon bg-orange"><i class="fas fa-exclamation-triangle"></i></div>
                            <div class="legend-info">
                                <h5>Taux Quarantaine</h5>
                                <p><strong>Formule :</strong> (Parcelles en Quarantaine ÷ Post-Traitées) × 100</p>
                                <p><strong>Description :</strong> Mesure la proportion des parcelles mises en quarantaine</p>
                                <p><strong>Exemple :</strong> 50 parcelles en quarantaine sur 1000 post-traitées → 5%</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon bg-red"><i class="fas fa-exclamation-circle"></i></div>
                            <div class="legend-info">
                                <h5>Taux Conflits</h5>
                                <p><strong>Formule :</strong> (Parcelles en Conflit ÷ Total Parcelles) × 100</p>
                                <p><strong>Description :</strong> Indique le pourcentage de parcelles avec des conflits fonciers</p>
                                <p><strong>Exemple :</strong> 10 parcelles en conflit sur 1000 → 1%</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="legend-section">
                    <h4><i class="fas fa-stream"></i> Pipeline de Traitement</h4>
                    <div class="pipeline-legend">
                        <div class="pipeline-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h5>Collecte</h5>
                                <p>Données brutes collectées sur le terrain</p>
                            </div>
                        </div>
                        <div class="pipeline-arrow">→</div>
                        <div class="pipeline-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h5>Dédoublonnage</h5>
                                <p>Suppression des doublons attributaires et géométriques</p>
                            </div>
                        </div>
                        <div class="pipeline-arrow">→</div>
                        <div class="pipeline-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h5>Post-Traitement</h5>
                                <p>Traitement des données pour validation</p>
                            </div>
                        </div>
                        <div class="pipeline-arrow">→</div>
                        <div class="pipeline-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h5>Validation</h5>
                                <p>Validation finale par URM/NICAD</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="legend-section">
                    <h4><i class="fas fa-chart-line"></i> Tendances</h4>
                    <div class="trends-legend">
                        <div class="trend-item positive">
                            <i class="fas fa-arrow-up"></i>
                            <div class="trend-value">+2.5%</div>
                            <div class="trend-description">
                                <strong>Tendance Positive</strong>
                                Amélioration des performances dans le temps
                            </div>
                        </div>
                        <div class="trend-item negative">
                            <i class="fas fa-arrow-down"></i>
                            <div class="trend-value">-1.8%</div>
                            <div class="trend-description">
                                <strong>Tendance Négative</strong>
                                Dégradation des performances à surveiller
                            </div>
                        </div>
                    </div>
                </section>

                <section class="legend-section">
                    <h4><i class="fas fa-star"></i> Niveaux de Performance</h4>
                    <div class="performance-legend">
                        <div class="performance-level excellent">
                            <div class="level-badge">Excellent</div>
                            <div class="level-range">≥ 80%</div>
                            <div class="level-description">Validation très élevée, processus optimal</div>
                        </div>
                        <div class="performance-level good">
                            <div class="level-badge">Bon</div>
                            <div class="level-range">60-80%</div>
                            <div class="level-description">Bonne performance, quelques améliorations possibles</div>
                        </div>
                        <div class="performance-level average">
                            <div class="level-badge">Moyen</div>
                            <div class="level-range">30-60%</div>
                            <div class="level-description">Performance acceptable, optimisation nécessaire</div>
                        </div>
                        <div class="performance-level poor">
                            <div class="level-badge">Faible</div>
                            <div class="level-range">0-30%</div>
                            <div class="level-description">Problèmes significatifs à corriger</div>
                        </div>
                        <div class="performance-level zero">
                            <div class="level-badge">Aucune</div>
                            <div class="level-range">0%</div>
                            <div class="level-description">Aucune validation, intervention urgente</div>
                        </div>
                    </div>
                </section>

                <section class="legend-section">
                    <h4><i class="fas fa-lightbulb"></i> Conseils d'Optimisation</h4>
                    <div class="tips-grid">
                        <div class="tip-item">
                            <i class="fas fa-check-circle text-blue"></i>
                            <p>Vérifiez régulièrement les données brutes pour identifier les erreurs de collecte</p>
                        </div>
                        <div class="tip-item">
                            <i class="fas fa-cogs text-green"></i>
                            <p>Automatisez le dédoublonnage pour réduire les erreurs manuelles</p>
                        </div>
                        <div class="tip-item">
                            <i class="fas fa-users text-orange"></i>
                            <p>Formez les équipes locales pour améliorer la qualité des données</p>
                        </div>
                        <div class="tip-item">
                            <i class="fas fa-chart-line text-purple"></i>
                            <p>Surveillez les tendances pour anticiper les problèmes</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
