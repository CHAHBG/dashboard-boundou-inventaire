<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord - Enquête Foncière PROCASF</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans transition-colors duration-300">
    <div class="container mx-auto p-6">
        <!-- Header -->
        <header class="bg-red-800 dark:bg-red-900 text-white p-4 rounded-lg shadow-lg mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold">Tableau de Bord - Enquête Foncière PROCASF</h1>
                <p class="text-sm">Dernière mise à jour : <span id="last-updated">20/08/2025 19:17:47</span></p>
            </div>
            <div class="flex gap-4">
                <button id="theme-toggle" class="bg-yellow-500 dark:bg-yellow-600 text-gray-900 dark:text-gray-100 px-4 py-2 rounded hover:bg-yellow-600 dark:hover:bg-yellow-700">
                    Mode Sombre
                </button>
                <button id="refresh-data" class="bg-blue-800 dark:bg-blue-900 text-white px-4 py-2 rounded hover:bg-blue-900 dark:hover:bg-blue-950">
                    Rafraîchir les Données
                </button>
            </div>
        </header>

        <!-- Guide Utilisateur -->
        <div class="mb-6">
            <button id="toggle-guide" class="bg-blue-800 dark:bg-blue-900 text-white px-4 py-2 rounded hover:bg-blue-900 dark:hover:bg-blue-950">Afficher le Guide</button>
            <div id="user-guide" class="hidden bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mt-4">
                <h2 class="text-xl font-semibold mb-2">Guide de l'Utilisateur</h2>
                <p class="mb-2">Ce tableau de bord présente les données de l'enquête foncière PROCASF avec des analyses détaillées.</p>
                <ul class="list-disc pl-5">
                    <li><strong>Métriques</strong> : Suivez les totaux, conflits, taux de succès et doublons.</li>
                    <li><strong>Filtres</strong> : Triez par commune, type de parcelle, date ou seuil de conflits.</li>
                    <li><strong>Graphiques</strong> : Explorez les répartitions et tendances avec des interactions (zoom, légendes).</li>
                    <li><strong>Tableau</strong> : Consultez les données brutes avec tri et recherche.</li>
                    <li><strong>Actions</strong> : Rafraîchissez les données ou exportez-les en CSV.</li>
                    <li><strong>Mode</strong> : Basculez entre sombre et clair pour une meilleure lisibilité.</li>
                </ul>
            </div>
        </div>

        <!-- Filtres -->
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-6 flex flex-wrap gap-4">
            <div>
                <label for="commune-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Commune</label>
                <select id="commune-filter" class="mt-1 p-2 border rounded bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 w-full">
                    <option value="all">Toutes</option>
                </select>
            </div>
            <div>
                <label for="parcel-type-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Type de Parcelle</label>
                <select id="parcel-type-filter" class="mt-1 p-2 border rounded bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 w-full">
                    <option value="all">Tous</option>
                    <option value="individual">Individuelles</option>
                    <option value="collective">Collectives</option>
                    <option value="conflict">Conflits</option>
                    <option value="no-join">Sans Jointure</option>
                </select>
            </div>
            <div>
                <label for="conflict-threshold" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Seuil Conflits</label>
                <input type="number" id="conflict-threshold" min="0" class="mt-1 p-2 border rounded bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 w-full" placeholder="Min. conflits">
            </div>
            <div>
                <label for="date-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Filtrer par Date</label>
                <input type="date" id="date-filter" class="mt-1 p-2 border rounded bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 w-full" value="2025-08-19">
            </div>
        </div>

        <!-- Métriques Clés -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md relative group">
                <h3 class="text-lg font-semibold">Total Parcelles</h3>
                <p id="total-parcels" class="text-2xl font-bold text-blue-800 dark:text-blue-400">0</p>
                <div class="absolute hidden group-hover:block bg-gray-800 text-white text-xs rounded p-2 -mt-16">Parcelles après nettoyage</div>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md relative group">
                <h3 class="text-lg font-semibold">Conflits</h3>
                <p id="total-conflicts" class="text-2xl font-bold text-red-800 dark:text-red-400">0</p>
                <div class="absolute hidden group-hover:block bg-gray-800 text-white text-xs rounded p-2 -mt-16">Parcelles individuelles et collectives</div>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md relative group">
                <h3 class="text-lg font-semibold">Taux de Succès</h3>
                <p id="success-rate" class="text-2xl font-bold text-green-700 dark:text-green-400">0%</p>
                <div class="absolute hidden group-hover:block bg-gray-800 text-white text-xs rounded p-2 -mt-16">Fichiers traités avec succès</div>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md relative group">
                <h3 class="text-lg font-semibold">Doublons Supprimés</h3>
                <p id="duplicates-removed" class="text-2xl font-bold text-yellow-700 dark:text-yellow-400">0</p>
                <div class="absolute hidden group-hover:block bg-gray-800 text-white text-xs rounded p-2 -mt-16">Doublons attributaires estimés</div>
            </div>
        </div>

        <!-- Graphiques -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-2">Parcelles par Commune</h3>
                <canvas id="parcels-by-commune"></canvas>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-2">Répartition des Types</h3>
                <canvas id="parcel-type-distribution"></canvas>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-2">Tendance Doublons</h3>
                <canvas id="duplicate-trend"></canvas>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-2">Taux Conflits par Commune</h3>
                <canvas id="conflict-rate"></canvas>
            </div>
        </div>

        <!-- Tableau -->
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-lg font-semibold">Données par Commune</h3>
                <button id="export-csv" class="bg-green-700 dark:bg-green-800 text-white px-4 py-2 rounded hover:bg-green-800 dark:hover:bg-green-900">Exporter CSV</button>
            </div>
            <div class="overflow-x-auto">
                <table id="commune-table" class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer" data-sort="commune">Commune</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer" data-sort="brutes">Brutes</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer" data-sort="sans_doublon_geometrique">Sans Doublons Géom.</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer" data-sort="sans_doublon_attributaire">Sans Doublons Att.</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer" data-sort="parcelles_collectives">Collectives</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer" data-sort="parcelles_individuelles">Individuelles</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer" data-sort="parcelles_en_conflits">Conflits</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer" data-sort="pas_de_jointure">Sans Jointure</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer" data-sort="post_traitees_lot_1_46">Post-Traitées</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer" data-sort="conflict_rate">Taux Conflits (%)</th>
                        </tr>
                    </thead>
                    <tbody id="commune-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                </table>
            </div>
            <div id="search-container" class="mt-4">
                <input type="text" id="search-table" class="p-2 border rounded w-full bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Rechercher dans le tableau...">
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
