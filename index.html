<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard EDL Post-Traitement - Boundou</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&family=Fira+Code&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
</head>
<body>
  <div class="dashboard">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>ContrÃ´les</h2>
        <button id="darkModeToggle" class="btn btn--sm">ğŸŒ™</button>
      </div>
      <section class="filters-panel card">
        <h3>Filtres</h3>
        <div class="filters-row">
          <div class="filter-group">
            <label class="form-label">Communes</label>
            <div class="commune-filters" id="communeFilters"></div>
          </div>
          <div class="filter-group">
            <label class="form-label" for="seuilFilter">Seuil Min. DonnÃ©es Brutes</label>
            <input type="range" id="seuilFilter" class="form-control" min="0" max="60000" value="0" step="100">
            <span id="seuilValue">0</span>
          </div>
          <div class="filter-group">
            <label class="form-label" for="performanceFilter">Taux de Validation</label>
            <select id="performanceFilter" class="form-control">
              <option value="all">Tous</option>
              <option value="high">Ã‰levÃ© (>70%)</option>
              <option value="medium">Moyen (30-70%)</option>
              <option value="low">Faible (<30%)</option>
              <option value="zero">Aucune validation</option>
            </select>
          </div>
          <div class="filter-group">
            <label class="form-label">ProblÃ¨mes SpÃ©ciaux</label>
            <div class="problem-filters">
              <label class="checkbox-label"><input type="checkbox" id="quarantineFilter"> Avec Quarantaines</label>
              <label class="checkbox-label"><input type="checkbox" id="noValidationFilter"> Sans Validation</label>
            </div>
          </div>
          <div class="filter-actions">
            <button id="applyFilters" class="btn btn--primary">Appliquer</button>
            <button id="resetFilters" class="btn btn--outline">RÃ©initialiser</button>
          </div>
        </div>
      </section>
      <div class="sidebar-footer">
        <button id="exportBtn" class="btn btn--primary">ğŸ“Š Exporter CSV</button>
        <button id="refreshBtn" class="btn btn--outline">ğŸ”„ Actualiser</button>
      </div>
    </aside>

    <main class="main-content">
      <header class="dashboard-header">
        <h1>ğŸ“ˆ Dashboard EDL Post-Traitement</h1>
        <h2>Inventaire Foncier - RÃ©gion de Boundou</h2>
        <p class="date">DonnÃ©es mises Ã  jour automatiquement - <span id="lastUpdate">Chargement...</span></p>
      </header>

      <!-- Section KPIs -->
      <section class="kpi-section">
        <h2>ğŸ“Š Indicateurs ClÃ©s de Performance</h2>
        <div class="kpi-grid">
          <div class="kpi-card card">
            <span class="kpi-icon">ğŸ“‹</span>
            <div class="kpi-content">
              <h3>Total DonnÃ©es Brutes</h3>
              <p class="kpi-value" id="kpi-brutes">0</p>
            </div>
          </div>
          <div class="kpi-card card">
            <span class="kpi-icon">ğŸ˜ï¸</span>
            <div class="kpi-content">
              <h3>Communes AnalysÃ©es</h3>
              <p class="kpi-value" id="kpi-communes">0</p>
            </div>
          </div>
          <div class="kpi-card card">
            <span class="kpi-icon">ğŸ”„</span>
            <div class="kpi-content">
              <h3>Taux DÃ©doublonnage</h3>
              <p class="kpi-value" id="kpi-dedoublonnage">0%</p>
            </div>
          </div>
          <div class="kpi-card card">
            <span class="kpi-icon">âš™ï¸</span>
            <div class="kpi-content">
              <h3>Taux Post-traitement</h3>
              <p class="kpi-value" id="kpi-post-traitement">0%</p>
            </div>
          </div>
          <div class="kpi-card card">
            <span class="kpi-icon">âœ…</span>
            <div class="kpi-content">
              <h3>Taux Validation URM/NICAD</h3>
              <p class="kpi-value" id="kpi-validation">0%</p>
            </div>
          </div>
          <div class="kpi-card card">
            <span class="kpi-icon">âš ï¸</span>
            <div class="kpi-content">
              <h3>Parcelles Quarantaine</h3>
              <p class="kpi-value" id="kpi-quarantaine">337</p>
              <small>Netteboulou - ForÃªt Gouloumbou</small>
            </div>
          </div>
        </div>
      </section>

      <!-- Section Graphiques -->
      <section class="charts-section">
        <h2>ğŸ“ˆ Analyses Graphiques Interactives</h2>
        <div class="charts-grid">
          <!-- Pipeline de traitement -->
          <div class="chart-card card">
            <div class="chart-header">
              <h3>ğŸ”„ Pipeline de Traitement des DonnÃ©es</h3>
              <div class="chart-controls">
                <button class="btn btn--sm chart-btn" data-action="zoom-in" data-chart="pipeline">ğŸ”+</button>
                <button class="btn btn--sm chart-btn" data-action="zoom-out" data-chart="pipeline">ğŸ”-</button>
                <button class="btn btn--sm chart-btn" data-action="reset-zoom" data-chart="pipeline">ğŸ”„</button>
                <button class="btn btn--sm chart-btn" data-action="fullscreen" data-chart="pipeline">ğŸ“±</button>
                <button class="btn btn--sm chart-btn" data-action="save-image" data-chart="pipeline">ğŸ’¾</button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="pipelineChart"></canvas>
            </div>
          </div>

          <!-- Comparaison par commune -->
          <div class="chart-card card">
            <div class="chart-header">
              <h3>ğŸ˜ï¸ Performance par Commune</h3>
              <div class="chart-controls">
                <button class="btn btn--sm chart-btn" data-action="zoom-in" data-chart="communes">ğŸ”+</button>
                <button class="btn btn--sm chart-btn" data-action="zoom-out" data-chart="communes">ğŸ”-</button>
                <button class="btn btn--sm chart-btn" data-action="reset-zoom" data-chart="communes">ğŸ”„</button>
                <button class="btn btn--sm chart-btn" data-action="fullscreen" data-chart="communes">ğŸ“±</button>
                <button class="btn btn--sm chart-btn" data-action="save-image" data-chart="communes">ğŸ’¾</button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="communesChart"></canvas>
            </div>
          </div>

          <!-- Taux de validation -->
          <div class="chart-card card">
            <div class="chart-header">
              <h3>ğŸ¯ Taux de Validation URM/NICAD</h3>
              <div class="chart-controls">
                <button class="btn btn--sm chart-btn" data-action="zoom-in" data-chart="validation">ğŸ”+</button>
                <button class="btn btn--sm chart-btn" data-action="zoom-out" data-chart="validation">ğŸ”-</button>
                <button class="btn btn--sm chart-btn" data-action="reset-zoom" data-chart="validation">ğŸ”„</button>
                <button class="btn btn--sm chart-btn" data-action="fullscreen" data-chart="validation">ğŸ“±</button>
                <button class="btn btn--sm chart-btn" data-action="save-image" data-chart="validation">ğŸ’¾</button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="validationChart"></canvas>
            </div>
          </div>

          <!-- EfficacitÃ© du traitement -->
          <div class="chart-card card">
            <div class="chart-header">
              <h3>âš¡ EfficacitÃ© du Traitement</h3>
              <div class="chart-controls">
                <button class="btn btn--sm chart-btn" data-action="zoom-in" data-chart="efficacite">ğŸ”+</button>
                <button class="btn btn--sm chart-btn" data-action="zoom-out" data-chart="efficacite">ğŸ”-</button>
                <button class="btn btn--sm chart-btn" data-action="reset-zoom" data-chart="efficacite">ğŸ”„</button>
                <button class="btn btn--sm chart-btn" data-action="fullscreen" data-chart="efficacite">ğŸ“±</button>
                <button class="btn btn--sm chart-btn" data-action="save-image" data-chart="efficacite">ğŸ’¾</button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="efficaciteChart"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Section Tableau -->
      <section class="table-section">
        <h2>ğŸ“‹ DonnÃ©es DÃ©taillÃ©es par Commune</h2>
        <div class="table-header">
          <input type="text" id="searchTable" class="form-control" placeholder="ğŸ” Rechercher par commune...">
          <div class="table-stats">
            <span id="tableStats">Affichage de toutes les communes</span>
          </div>
        </div>
        <div class="table-container card">
          <table id="communeTable">
            <thead>
              <tr>
                <th data-column="commune" class="sortable" data-tooltip="Nom de la commune">ğŸ˜ï¸ Commune</th>
                <th data-column="donnees_brutes" class="sortable" data-tooltip="DonnÃ©es initiales collectÃ©es">ğŸ“‹ DonnÃ©es Brutes</th>
                <th data-column="sans_doublons_attributaire_et_geometriqu" class="sortable" data-tooltip="AprÃ¨s suppression des doublons gÃ©omÃ©triques et attributaires">ğŸ”„ Sans Doublons</th>
                <th data-column="post_traitees" class="sortable" data-tooltip="DonnÃ©es aprÃ¨s traitement technique">âš™ï¸ Post-traitÃ©es</th>
                <th data-column="valideespar_urm_nicad" class="sortable" data-tooltip="ValidÃ©es par URM et NICAD">âœ… ValidÃ©es URM/NICAD</th>
                <th data-column="taux_dedoublonnage" class="sortable" data-tooltip="Pourcentage de conservation aprÃ¨s dÃ©doublonnage">ğŸ“Š Taux DÃ©doublonnage</th>
                <th data-column="taux_validation" class="sortable" data-tooltip="Pourcentage de validation finale">ğŸ¯ Taux Validation</th>
                <th data-column="quarantaines" class="sortable" data-tooltip="Parcelles en quarantaine spÃ©ciale">âš ï¸ Quarantaines</th>
              </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
          </table>
        </div>
        <div class="table-pagination">
          <span id="paginationInfo">Chargement...</span>
          <div class="pagination-controls">
            <button id="prevPage" class="btn page-btn">â—€ PrÃ©cÃ©dent</button>
            <div id="pageNumbers"></div>
            <button id="nextPage" class="btn page-btn">Suivant â–¶</button>
          </div>
        </div>
      </section>

      <!-- Section LÃ©gende -->
      <section class="legend-section card">
        <h2>ğŸ“š Guide des Termes et DÃ©finitions</h2>
        <div class="legend-grid">
          <div class="legend-item">
            <h4>ğŸ“‹ DonnÃ©es Brutes (LevÃ©es Brutes)</h4>
            <p>DonnÃ©es topographiques et cadastrales collectÃ©es directement sur le terrain lors des opÃ©rations d'arpentage. Incluent toutes les parcelles identifiÃ©es sans aucun filtrage.</p>
          </div>
          <div class="legend-item">
            <h4>ğŸ”„ Sans Doublons GÃ©omÃ©triques et Attributaires</h4>
            <p>DonnÃ©es aprÃ¨s suppression des duplicatas basÃ©s sur les coordonnÃ©es gÃ©omÃ©triques et les attributs identiques (mÃªme propriÃ©taire, mÃªme localisation, etc.).</p>
          </div>
          <div class="legend-item">
            <h4>âš™ï¸ Post-traitÃ©es</h4>
            <p>DonnÃ©es ayant subi les traitements techniques : correction des erreurs gÃ©omÃ©triques, normalisation des attributs, vÃ©rification de cohÃ©rence spatiale.</p>
          </div>
          <div class="legend-item">
            <h4>âœ… ValidÃ©es par URM/NICAD</h4>
            <p>Parcelles approuvÃ©es par l'UnitÃ© de RÃ©forme du MillÃ©naire (URM) et le Nouveau Cadastre (NICAD) aprÃ¨s vÃ©rification administrative et juridique.</p>
          </div>
          <div class="legend-item">
            <h4>âš ï¸ Parcelles en Quarantaine (Netteboulou)</h4>
            <p><strong>337 parcelles</strong> identifiÃ©es dans la forÃªt de Gouloumbou Ã  Netteboulou, mises en quarantaine pour rÃ©solution de conflits fonciers ou environnementaux.</p>
          </div>
          <div class="legend-item">
            <h4>ğŸ¯ Taux de Validation</h4>
            <p>Pourcentage de parcelles post-traitÃ©es qui ont Ã©tÃ© validÃ©es par les organismes officiels (URM/NICAD). Indicateur clÃ© de qualitÃ©.</p>
          </div>
          <div class="legend-item">
            <h4>ğŸ“Š Processus de QualitÃ©</h4>
            <p>Le pipeline suit : <em>LevÃ©es â†’ DÃ©doublonnage â†’ Post-traitement â†’ Validation</em>. Chaque Ã©tape amÃ©liore la qualitÃ© et la fiabilitÃ© des donnÃ©es fonciÃ¨res.</p>
          </div>
          <div class="legend-item">
            <h4>ğŸ” MÃ©thodes de VÃ©rification</h4>
            <p>ContrÃ´les gÃ©omÃ©triques automatisÃ©s, vÃ©rifications attributaires, validation croisÃ©e avec les registres fonciers existants.</p>
          </div>
        </div>
      </section>

      <footer class="dashboard-footer">
        <p>Â© 2025 - Dashboard EDL Post-Traitement - Inventaire Foncier Boundou</p>
        <p>DonnÃ©es mises Ã  jour automatiquement depuis EDL_PostTraitement.json</p>
      </footer>
    </main>

    <!-- Modal plein Ã©cran -->
    <div id="fullscreenModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">Graphique en Plein Ã‰cran</h3>
          <button id="closeModal" class="btn btn--sm">âœ–</button>
        </div>
        <div class="modal-body">
          <canvas id="fullscreenChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="notifications"></div>
    
    <!-- Tooltip -->
    <div id="tooltip" class="tooltip hidden"></div>

    <!-- Menu hamburger pour mobile -->
    <button id="hamburger" class="hamburger btn btn--sm">â˜°</button>
  </div>

  <script src="app.js"></script>
</body>
</html>
